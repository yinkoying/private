<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <title>iPASæ·¨é›¶è¦åŠƒç®¡ç†å¸« - AI æ™ºèƒ½ç·´ç¿’ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f8fafc; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const AppTitle = "iPASæ·¨é›¶è¦åŠƒç®¡ç†å¸«";
        const ThemeColor = "blue";
        
        // è€ƒè©¦çµæ§‹å®šç¾©
        const EXAM_DATA = {
            "åˆç´š": {
                theme: "green",
                subjects: {
                    "è€ƒç§‘ä¸€ï¼šæ·¨é›¶ç¢³è¦åŠƒç®¡ç†åŸºç¤æ¦‚è«–": {
                        "æ·¨é›¶ç¢³ç®¡ç†è¶¨å‹¢èˆ‡æ”¿ç­–": ["å…¨çƒæ°£å€™è®Šé·èˆ‡åœ‹éš›å…¬ç´„", "CBAMèˆ‡åœ‹éš›ç¢³ç®¡åˆ¶è¶¨å‹¢", "æˆ‘åœ‹æ°£å€™è®Šé·å› æ‡‰æ³•èˆ‡ç›¸é—œæ”¿ç­–", "ä¼æ¥­ESGèˆ‡æ°¸çºŒç™¼å±•"],
                        "æº«å®¤æ°£é«”ç®¡ç†æ¨™æº–æ¦‚è«–": ["ISO 14060ç³»åˆ—æ¨™æº–é«”ç³»", "æº«å®¤æ°£é«”ç›¤æŸ¥è­°å®šæ›¸(GHG Protocol)", "æŸ¥è­‰èˆ‡ç¢ºä¿¡åŸºæœ¬è§€å¿µ"]
                    },
                    "è€ƒç§‘äºŒï¼šæ·¨é›¶ç¢³ç›¤æŸ¥è¦ç¯„èˆ‡ç¨‹åºæ¦‚è¦": {
                        "çµ„ç¹”å‹æº«å®¤æ°£é«”ç›¤æŸ¥": ["ISO 14064-1 æ¨™æº–è§£æ", "é‚Šç•Œè¨­å®šèˆ‡æ’æ”¾æºé‘‘åˆ¥", "é‡åŒ–è¨ˆç®—æ–¹æ³•", "ç›¤æŸ¥å ±å‘Šæ›¸æ¶æ§‹"],
                        "ç”¢å“ç¢³è¶³è·¡ç›¤æŸ¥": ["ISO 14067 æ¨™æº–è§£æ", "ç”Ÿå‘½é€±æœŸè©•ä¼°(LCA)åŸºç¤", "ç”¢å“é¡åˆ¥è¦å‰‡(PCR)", "ç¢³æ¨™ç±¤åˆ¶åº¦"]
                    }
                },
                passing: "åŒæ™‚å ±è€ƒ2ç§‘ï¼Œå¹³å‡70åˆ†ä¸”å–®ç§‘ä¸ä½æ–¼60åˆ†ï¼›æˆ–å–®ç§‘åŠæ ¼ä¿ç•™ï¼ˆ70åˆ†ï¼‰ã€‚"
            },
            "ä¸­ç´š": {
                theme: "blue",
                subjects: {
                    "è€ƒç§‘ä¸€ï¼šç¯€èƒ½æ¸›ç¢³æŠ€è¡“å¯¦å‹™": {
                        "çµ„ç¹”ç¯€èƒ½æ¸›ç¢³ç­–ç•¥": ["æ¸›ç¢³/ç¯€èƒ½ç›®æ¨™è¨­å®šèˆ‡è·¯å¾‘è¦åŠƒ", "ç¢³æ’ç†±å€è¾¨è­˜èˆ‡èƒ½æºç›¤æŸ¥è³‡æ–™è§£æ", "è²¡å‹™æ±ºç­–æ¨¡å‹èˆ‡é¢¨éšªè©•ä¼°"],
                        "ç¯€èƒ½æŠ€è¡“æ‡‰ç”¨èˆ‡èƒ½æºç®¡ç†": ["å…¬ç”¨è¨­æ–½ç¯€èƒ½æŠ€è¡“é¸ç”¨åˆ†æ", "ç¯€èƒ½æŠ€è¡“æŠ•è³‡æ•ˆç›Šèˆ‡å›æ”¶æœŸè©•ä¼°", "ESCOæ‡‰ç”¨å¯¦å‹™", "ISO 50001èƒ½æºç®¡ç†ç³»çµ±å°å…¥èˆ‡é‹ç”¨", "ç¯€èƒ½ç›¸é—œå‰ç»æŠ€è¡“"],
                        "å†ç”Ÿèƒ½æºèˆ‡ç¶ é›»å°å…¥": ["å†ç”Ÿèƒ½æºç¨®é¡åŠå„ªç¼ºé»æ¯”è¼ƒ", "åœ‹å…§å†ç”Ÿèƒ½æºå°å…¥åŠæ•ˆç›Šè©•ä¼°", "ç¶ é›»æ¡è³¼æ¨¡å¼èˆ‡åˆ¶åº¦"]
                    },
                    "è€ƒç§‘äºŒï¼šç¢³ç®¡ç†åˆ¶åº¦å¯¦å‹™": {
                        "ç¢³è¦ç¯„å¯¦å‹™èˆ‡æ­éœ²æº–å‰‡æ‡‰ç”¨": ["åœ‹å…§æ°£å€™ç›¸é—œæ”¿ç­–èˆ‡æ¸›ç¢³æ³•è¦ä¹‹æ‡‰ç”¨", "åœ‹éš›æ­éœ²åˆ¶åº¦æ¶æ§‹ç†è§£èˆ‡å¯¦å‹™æ‡‰ç”¨", "æ¸›ç¢³ç›¸é—œå€¡è­°èˆ‡æº–å‰‡å¯¦å‹™æ¥è»Œ"],
                        "çµ„ç¹”è‡ªé¡˜æ¸›é‡å¯¦å‹™": ["åœ‹å…§å¤–è‡ªé¡˜æ¸›é‡å°ˆæ¡ˆèˆ‡æŠµæ›åˆ¶åº¦", "ç¢³ç§»é™¤èˆ‡è² ç¢³æŠ€è¡“", "ç¢³æŠµæ›èˆ‡ç¢³è³‡æºäº¤æ˜“", "å…§éƒ¨ç¢³å®šåƒ¹èˆ‡ç¢³è³‡ç”¢ç®¡ç†"],
                        "æ°¸çºŒä¾›æ‡‰éˆç®¡ç†": ["ç¯„ç–‡ä¸‰ç¢³æ’æ•¸æ“šç›¤æŸ¥èˆ‡ä¼°ç®—å¯¦å‹™", "ä¾›æ‡‰éˆæ¸›ç¢³é¢¨éšªè©•ä¼°èˆ‡ç®¡ç†æ©Ÿåˆ¶"]
                    }
                },
                passing: "å…©ç§‘çš†é” 70 åˆ†ã€‚"
            }
        };

        // Icons
        const IconBase = ({ children, size=24, className="" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Save = (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Edit = (p) => <IconBase {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconBase>;
        const FileJson = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M10 13a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2"/><path d="M14 13a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2"/></IconBase>;
        const Play = (p) => <IconBase {...p}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const FolderOpen = (p) => <IconBase {...p}><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const BookOpen = (p) => <IconBase {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>;
        const FileSpreadsheet = (p) => <IconBase {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h8"/><path d="M8 17h8"/><path d="M14 13v4"/></IconBase>;
        const MessageCircleQuestion = (p) => <IconBase {...p}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconBase>;
        const X = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="M6 6 18 18"/></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>;
        const ChevronUp = (p) => <IconBase {...p}><polyline points="18 15 12 9 6 15"/></IconBase>;
        const ChevronDown = (p) => <IconBase {...p}><polyline points="6 9 12 15 18 9"/></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></IconBase>;
        const Book = (p) => <IconBase {...p}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></IconBase>;
        const BarChart2 = (p) => <IconBase {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></IconBase>;
        const Clock = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const Type = (p) => <IconBase {...p}><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconBase>;
        const Bot = (p) => <IconBase {...p}><path d="M12 2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2v0a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/><path d="M19 11v-2a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v2"/><path d="M5 16v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2"/><path d="M9 11v5"/><path d="M15 11v5"/></IconBase>;
        const Copy = (p) => <IconBase {...p}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></IconBase>;
        const CheckSquare = (p) => <IconBase {...p}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></IconBase>;

        // é è¨­ç¯„ä¾‹é¡Œç›® (åŒ…å«ä¸€å€‹è¤‡é¸ç¯„ä¾‹)
        const DEFAULT_QUESTIONS = [
            {
                id: 1715424000000,
                level: "ä¸­ç´š",
                subject: "è€ƒç§‘äºŒï¼šç¢³ç®¡ç†åˆ¶åº¦å¯¦å‹™",
                section: "çµ„ç¹”è‡ªé¡˜æ¸›é‡å¯¦å‹™",
                topic: "åœ‹å…§å¤–è‡ªé¡˜æ¸›é‡å°ˆæ¡ˆèˆ‡æŠµæ›åˆ¶åº¦",
                question: "ä¾æ“šæˆ‘åœ‹ã€Šæ°£å€™è®Šé·å› æ‡‰æ³•ã€‹ï¼Œç¶“ä¸­å¤®ä¸»ç®¡æ©Ÿé—œæ ¸å‡†ä¹‹å¢é‡æŠµæ›ç”¨é€”ï¼Œå…¶æŠµæ›æ¯”ç‡ç‚ºä½•ï¼Ÿ",
                options: ["1:1.1", "1:1.2", "1:1.15", "1:1.3"],
                correctAnswer: "1:1.15",
                explanation: "ä¾æ“šæˆ‘åœ‹ã€Šæº«å®¤æ°£é«”å¢é‡æŠµæ›è™•ç†åŸå‰‡ã€‹ï¼Œæ–°è¨­æˆ–è®Šæ›´çš„æ’æ”¾æºéœ€æŠµæ›å…¶å¢é‡çš„ 1.15 å€ (å³ 1:1.15)ï¼Œä»¥ç¢ºä¿æŠµæ›å…·æœ‰ã€Œæ·¨æ¸›é‡ã€æ•ˆæœã€‚"
            }
        ];

        const SyllabusAccordion = ({ title, chapters, color }) => {
            const [isOpen, setIsOpen] = useState(false);
            const themeColors = {
                green: { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-800', marker: 'bg-green-400' },
                blue: { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-800', marker: 'bg-blue-400' }
            };
            const theme = themeColors[color] || themeColors.blue;

            return (
                <div className={`mb-3 rounded-lg border ${theme.border} overflow-hidden`}>
                    <button onClick={() => setIsOpen(!isOpen)} className={`w-full text-left p-3 ${theme.bg} ${theme.text} font-bold text-sm flex justify-between items-center transition-colors hover:opacity-90`}>
                        <span>{title}</span>
                        {isOpen ? <ChevronUp size={16}/> : <ChevronDown size={16}/>}
                    </button>
                    {isOpen && (
                        <div className="p-4 bg-white space-y-4">
                            {Object.entries(chapters).map(([chapName, details], idx) => (
                                <div key={idx}>
                                    <div className="text-xs font-bold text-slate-800 mb-2 flex items-center">
                                        <div className={`w-1.5 h-1.5 rounded-full ${theme.marker} mr-2`}></div>
                                        {chapName}
                                    </div>
                                    <ul className="text-xs text-slate-600 pl-4 space-y-1">
                                        {details.map((d, i) => <li key={i} className="list-disc list-item ml-2">{d}</li>)}
                                    </ul>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        function ExamSystem() {
          const [questions, setQuestions] = useState(() => {
            try { 
                const saved = JSON.parse(localStorage.getItem('myExamBank_v2'));
                if (!saved) return DEFAULT_QUESTIONS;
                return saved.map(q => { 
                    if (q.level) return q;
                    const isJunior = q.subject.includes("æ·¨é›¶ç¢³è¦åŠƒ") || q.subject.includes("ç›¤æŸ¥è¦ç¯„");
                    return { ...q, level: isJunior ? "åˆç´š" : "ä¸­ç´š" };
                });
            } catch { return DEFAULT_QUESTIONS; }
          });
          const [wrongBank, setWrongBank] = useState(() => {
             try { return JSON.parse(localStorage.getItem('myWrongBank_v2')) || []; } catch { return []; }
          });
          const [stats, setStats] = useState(() => {
             try { return JSON.parse(localStorage.getItem('myExamStats')) || {}; } catch { return {}; }
          });

          // UI States
          const [activeTab, setActiveTab] = useState('intro');
          const [notification, setNotification] = useState(null);
          const [fontSize, setFontSize] = useState('text-sm'); 
          const [helperOpen, setHelperOpen] = useState(false);
          
          // Edit States
          const [newQ, setNewQ] = useState({ level: 'ä¸­ç´š', subject: '', section: '', topic: '', question: '', options: ['', '', '', ''], correctAnswer: '', explanation: '' });
          const [isEditMode, setIsEditMode] = useState(false);
          const [editId, setEditId] = useState(null);
          const [showEditModal, setShowEditModal] = useState(false);

          // AI Import State
          const [jsonInput, setJsonInput] = useState('');

          // Bank Filter States
          const [bankFilter, setBankFilter] = useState({ keyword: '', level: 'all', subject: 'all' });

          // Quiz States
          const [bulkPreview, setBulkPreview] = useState([]);
          const [quizConfig, setQuizConfig] = useState({ level: 'ä¸­ç´š', subject: 'all', mode: 'normal', count: 20 });
          const [currentQuiz, setCurrentQuiz] = useState([]);
          const [quizIndex, setQuizIndex] = useState(0);
          const [quizAnswers, setQuizAnswers] = useState({}); // Stores user answers. For multi, stores array.
          const [quizConfirmed, setQuizConfirmed] = useState(new Set()); // For multi-choice/mock, confirm status
          const [isQuizActive, setIsQuizActive] = useState(false);
          
          // Mock Exam States
          const [timer, setTimer] = useState(0);
          const timerRef = useRef(null);

          useEffect(() => { localStorage.setItem('myExamBank_v2', JSON.stringify(questions)); }, [questions]);
          useEffect(() => { localStorage.setItem('myWrongBank_v2', JSON.stringify(wrongBank)); }, [wrongBank]);
          useEffect(() => { localStorage.setItem('myExamStats', JSON.stringify(stats)); }, [stats]);

          const showNotify = (msg, type = 'success') => {
            setNotification({ msg, type });
            setTimeout(() => setNotification(null), 3000);
          };

          const getSubjects = (level) => (EXAM_DATA[level] ? Object.keys(EXAM_DATA[level].subjects) : []);
          
          const handleNavChange = (tab) => {
            if (tab === 'quiz') {
                if (isQuizActive && currentQuiz.length) {
                    activeTab === 'quiz_running' || quizIndex >= currentQuiz.length ? setActiveTab(quizIndex >= currentQuiz.length ? 'quiz_summary' : 'quiz_running') : setActiveTab('quiz');
                } else setActiveTab('quiz');
            } else setActiveTab(tab);
          };

          const updateStats = (subject, isCorrect) => {
              setStats(prev => {
                  const s = prev[subject] || { total: 0, correct: 0 };
                  return {
                      ...prev,
                      [subject]: { total: s.total + 1, correct: s.correct + (isCorrect ? 1 : 0) }
                  };
              });
          };

          const saveQuestion = () => {
            if (!newQ.subject || !newQ.question || !newQ.correctAnswer) return showNotify("è³‡æ–™ä¸å®Œæ•´", 'error');
            if (isEditMode && editId) {
                setQuestions(prev => prev.map(q => q.id === editId ? { ...newQ, id: editId } : q));
                showNotify("å·²æ›´æ–°");
                setShowEditModal(false);
            } 
          };

          const openEditModal = (q) => {
              setNewQ({ ...q });
              setIsEditMode(true);
              setEditId(q.id);
              setShowEditModal(true);
          };
          
          const deleteQuestion = (id) => {
            if (confirm("åˆªé™¤æ­¤é¡Œï¼Ÿ")) {
              setQuestions(questions.filter(q => q.id !== id));
              setWrongBank(wrongBank.filter(qid => qid !== id));
              showNotify("å·²åˆªé™¤");
            }
          };

          const handleJsonImport = () => {
              try {
                  const parsed = JSON.parse(jsonInput);
                  if (!Array.isArray(parsed)) throw new Error("æ ¼å¼éŒ¯èª¤ï¼šæ‡‰ç‚ºé™£åˆ—");
                  
                  const validQuestions = parsed.filter(q => q.question && q.options && q.correctAnswer).map((q, i) => ({
                      ...q,
                      id: Date.now() + i,
                      level: q.level || "ä¸­ç´š"
                  }));

                  if (validQuestions.length === 0) throw new Error("ç„¡æœ‰æ•ˆé¡Œç›®");

                  setQuestions([...questions, ...validQuestions]);
                  setJsonInput('');
                  showNotify(`æˆåŠŸåŒ¯å…¥ ${validQuestions.length} é¡Œ JSON é¡Œåº«`);
              } catch (e) {
                  showNotify("JSON è§£æå¤±æ•—ï¼Œè«‹æª¢æŸ¥æ ¼å¼", 'error');
              }
          };

          // Helper to parse answer string to normalized array
          const normalizeAnswer = (q) => {
              const ans = q.correctAnswer;
              if (Array.isArray(ans)) return ans.map(String).sort();
              if (typeof ans !== 'string') return [String(ans)];
              
              // Handle "é¸é …1, é¸é …2" format
              if (ans.includes('é¸é …')) {
                  const indices = ans.match(/é¸é …(\d+)/g)?.map(s => parseInt(s.replace('é¸é …','')) - 1) || [];
                  return indices.map(i => q.options[i]).filter(Boolean).sort();
              }
              // Handle comma separated values (A, B, C) if not "é¸é …"
              if (ans.includes(',')) {
                  // Try to see if it matches options
                  const splitAns = ans.split(/[,ï¼Œã€]/).map(s => s.trim());
                  // Check if split answers match options content or ABCD
                  // For simplicity, if split answer is not A,B,C, assume it is option text
                  // If "A", map to options[0]
                  return splitAns.map(s => {
                      if (['A','B','C','D'].includes(s.toUpperCase())) {
                          const idx = s.toUpperCase().charCodeAt(0) - 65;
                          return q.options[idx];
                      }
                      return s;
                  }).filter(Boolean).sort();
              }
              
              // Single string
              return [ans.trim()];
          };

          const checkIsCorrect = (q, userAns) => {
              if (!userAns) return false;
              const correctSet = normalizeAnswer(q);
              const userSet = Array.isArray(userAns) ? [...userAns].sort() : [userAns];
              
              if (correctSet.length !== userSet.length) return false;
              return correctSet.every((val, index) => val === userSet[index]);
          };

          const copyAiPrompt = (level) => {
              const data = EXAM_DATA[level];
              if (!data) return;

              let syllabusStr = "";
              Object.entries(data.subjects).forEach(([subject, chapters]) => {
                  syllabusStr += `\nã€${subject}ã€‘åŒ…å«ï¼š`;
                  Object.entries(chapters).forEach(([chapter, details]) => {
                      syllabusStr += `${chapter}(${details.join('ã€')})ã€`;
                  });
              });

              let specificInst = "";
              if (level === 'ä¸­ç´š') {
                  specificInst = "é¡Œç›®é¡å‹è«‹åŒ…å«ã€Œå–®é¸é¡Œã€ã€ã€Œè¤‡é¸é¡Œã€ä»¥åŠã€Œæƒ…å¢ƒé¡Œã€(Scenario-based, åŒ…å«é¡Œå¹¹æè¿°)ã€‚è‹¥æ˜¯è¤‡é¸é¡Œï¼Œè«‹åœ¨é¡Œç›®å¾Œæ–¹æ¨™è¨»ã€Œ(è¤‡é¸)ã€ï¼Œä¸¦ç¢ºä¿ correctAnswer æ ¼å¼ç‚ºã€Œé¸é …1, é¸é …2...ã€ä¹‹é¡çš„å½¢å¼ã€‚æƒ…å¢ƒé¡Œè«‹å°‡æƒ…å¢ƒæè¿°å¯«åœ¨ 'question' æ¬„ä½ä¸­ã€‚";
              } else {
                  specificInst = "é¡Œç›®é¡å‹ä»¥ã€Œå–®é¸é¡Œã€ç‚ºä¸»ï¼Œè‘—é‡åŸºæœ¬å®šç¾©èˆ‡è¦ç¯„ç†è§£ã€‚";
              }

              const promptText = `è«‹å¹«æˆ‘å‡º 5 é¡Œ iPAS æ·¨é›¶ç¢³è¦åŠƒç®¡ç†å¸«ã€Œ${level}ã€çš„æ¨¡æ“¬è©¦é¡Œã€‚\n\nè€ƒç§‘ç¯„åœèˆ‡ç´°é …å¦‚ä¸‹ï¼š${syllabusStr}\n\n${specificInst}\n\nâ€» æ¨¡æ“¬è©¦é¡Œåƒ…ä¾›åƒè€ƒï¼Œéæ­£å¼è€ƒé¡Œå…§å®¹ã€‚\n\nè«‹åš´æ ¼éµå®ˆä»¥ä¸‹ JSON æ ¼å¼å›å‚³ï¼Œç›´æ¥çµ¦å‡º JSON é™£åˆ—ï¼Œä¸è¦æœ‰ Markdown code block (ä¾‹å¦‚ \`\`\`json)ï¼Œä¹Ÿä¸è¦å…¶ä»–æ–‡å­—ï¼š\n[\n  {\n    "level": "${level}",\n    "subject": "ç§‘ç›®åç¨±",\n    "section": "ç« ç¯€",\n    "topic": "ç´°é …",\n    "question": "é¡Œç›®æ•˜è¿° (è¤‡é¸)",\n    "options": ["é¸é …1", "é¸é …2", "é¸é …3", "é¸é …4"],\n    "correctAnswer": "é¸é …1, é¸é …2",\n    "explanation": "è©³è§£"\n  }\n]`;
              
              const el = document.createElement('textarea');
              el.value = promptText;
              document.body.appendChild(el);
              el.select();
              document.execCommand('copy');
              document.body.removeChild(el);
              showNotify(`å·²è¤‡è£½ã€Œ${level}ã€è©³ç´°å‡ºé¡ŒæŒ‡ä»¤ï¼`);
          };

          // Excel Handling (omitted logic same as before, no changes needed for this part)
          const exportToExcel = () => { /* ... existing code ... */ 
             if(!questions.length) return showNotify('ç„¡è³‡æ–™å¯åŒ¯å‡º', 'error');
             const ws = XLSX.utils.json_to_sheet(questions.map(q => ({
                 'ç­‰ç´š': q.level || 'ä¸­ç´š', 'ç§‘ç›®': q.subject, 'ä¸»é¡Œ': q.section, 'å…§å®¹': q.topic, 'é¡Œç›®': q.question,
                 'A': q.options[0], 'B': q.options[1], 'C': q.options[2], 'D': q.options[3],
                 'æ­£ç¢ºç­”æ¡ˆ': q.correctAnswer, 'è§£æ': q.explanation
             })));
             const wb = XLSX.utils.book_new();
             XLSX.utils.book_append_sheet(wb, ws, "é¡Œåº«");
             XLSX.writeFile(wb, `iPAS_Export_${new Date().toISOString().slice(0,10)}.xlsx`);
          };
          const downloadTemplate = () => {
             const headers = [['ç­‰ç´š', 'ç§‘ç›®', 'ä¸»é¡Œ', 'å…§å®¹', 'é¡Œç›®', 'A', 'B', 'C', 'D', 'æ­£ç¢ºç­”æ¡ˆ', 'è§£æ']];
             const sampleData = [['ä¸­ç´š', 'è€ƒç§‘äºŒï¼šç¢³ç®¡ç†åˆ¶åº¦å¯¦å‹™', 'çµ„ç¹”è‡ªé¡˜æ¸›é‡å¯¦å‹™', 'æŠµæ›åˆ¶åº¦', 'ç¯„ä¾‹é¡Œç›®...', 'A', 'B', 'C', 'D', 'A', 'è§£æ...']];
             const ws = XLSX.utils.aoa_to_sheet([...headers, ...sampleData]);
             const wb = XLSX.utils.book_new();
             XLSX.utils.book_append_sheet(wb, ws, "ç¯„ä¾‹æ ¼å¼");
             XLSX.writeFile(wb, "iPAS_é¡Œåº«ç¯„ä¾‹.xlsx");
          };
          const handleExcelUpload = (e) => {
            const f = e.target.files[0]; if (!f) return;
            const r = new FileReader();
            r.onload = (evt) => {
                try {
                    const ws = XLSX.read(new Uint8Array(evt.target.result), {type: 'array'}).Sheets[XLSX.read(new Uint8Array(evt.target.result), {type: 'array'}).SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(ws, {header: 1});
                    const parsed = [];
                    rows.forEach((r, i) => {
                        if (r.length < 5 || String(r[0]).includes('ç­‰ç´š')) return;
                        const isNew = ["åˆç´š", "ä¸­ç´š"].includes(String(r[0]).trim());
                        let lvl = isNew ? r[0] : "ä¸­ç´š";
                        let sub = isNew ? r[1] : r[0];
                        let sec = isNew ? r[2] : r[1];
                        let top = isNew ? r[3] : r[2];
                        let qT = isNew ? r[4] : r[3];
                        let ops = isNew ? [r[5],r[6],r[7],r[8]] : [r[4],r[5],r[6],r[7]];
                        let cor = isNew ? r[9] : r[8];
                        let exp = isNew ? r[10] : r[9];
                        
                        const cleanOpts = ops.filter(o=>o&&String(o).trim()).map(String);
                        let c = cor ? String(cor).trim() : '';
                        
                        if(qT) parsed.push({id: Date.now()+i, level: lvl, subject: sub||'æœªåˆ†é¡', section: sec||'', topic: top||'', question: qT, options: cleanOpts, correctAnswer: c, explanation: exp||''});
                    });
                    setBulkPreview(parsed);
                    parsed.length ? showNotify(`è§£æ ${parsed.length} ç­†`) : showNotify("ç„¡è³‡æ–™", 'error');
                } catch { showNotify("è®€å–å¤±æ•—", 'error'); }
            };
            r.readAsArrayBuffer(f);
            e.target.value = '';
          };

          const startQuiz = () => {
            let qList = questions.filter(q => q.level === quizConfig.level);
            if (quizConfig.subject !== 'all') qList = qList.filter(q => q.subject === quizConfig.subject);
            if (quizConfig.mode === 'wrong_review') qList = qList.filter(q => wrongBank.includes(q.id));
            
            if (!qList.length) return showNotify("ç„¡ç¬¦åˆæ¢ä»¶é¡Œç›®", 'error');
            
            let finalQ = qList.sort(() => Math.random() - 0.5);
            if (quizConfig.count !== 'all') finalQ = finalQ.slice(0, parseInt(quizConfig.count));

            setCurrentQuiz(finalQ);
            setQuizIndex(0); 
            setQuizAnswers({});
            setQuizConfirmed(new Set());
            setIsQuizActive(true); 
            setActiveTab('quiz_running');

            if (quizConfig.mode === 'mock') {
                setTimer(60 * 60); 
            }
          };

          useEffect(() => {
              if (activeTab === 'quiz_running' && quizConfig.mode === 'mock' && timer > 0) {
                  timerRef.current = setInterval(() => setTimer(t => t - 1), 1000);
              } else {
                  clearInterval(timerRef.current);
              }
              return () => clearInterval(timerRef.current);
          }, [activeTab, quizConfig.mode, timer]);

          const handleOptionClick = (q, opt) => {
              const isMulti = q.question.includes("è¤‡é¸") || q.correctAnswer.includes("é¸é …") || q.correctAnswer.includes(",");
              const isMock = quizConfig.mode === 'mock';
              const confirmed = quizConfirmed.has(q.id);

              if (confirmed && !isMock) return; // Prevent changing if already answered in normal mode

              setQuizAnswers(prev => {
                  const currentAns = prev[q.id];
                  
                  if (isMulti) {
                      // Multi logic: Toggle
                      const arr = Array.isArray(currentAns) ? currentAns : [];
                      if (arr.includes(opt)) return { ...prev, [q.id]: arr.filter(o => o !== opt) };
                      return { ...prev, [q.id]: [...arr, opt] };
                  } else {
                      // Single logic: Set and auto-submit if Normal mode
                      if (!isMock) {
                          // Normal Mode Single: Submit immediately
                          // We need to trigger stats update here or in a useEffect.
                          // But we can't trigger effect easily. 
                          // Let's just set confirmed immediately.
                          // Calling logic for normal single submission below
                          setTimeout(() => submitAnswer(q, opt), 0);
                      }
                      return { ...prev, [q.id]: opt };
                  }
              });
          };

          const submitAnswer = (q, singleOptVal) => {
              // Only for Normal Mode
              if (quizConfig.mode === 'mock') return;
              
              setQuizConfirmed(prev => new Set(prev).add(q.id));
              
              // For single choice, we passed the value. For multi, we get from state.
              const userAns = singleOptVal || quizAnswers[q.id];
              const isCorrect = checkIsCorrect(q, userAns);
              
              updateStats(q.subject, isCorrect);
              if (isCorrect) {
                  if (wrongBank.includes(q.id)) setWrongBank(prev => prev.filter(id => id !== q.id));
              } else if (!wrongBank.includes(q.id)) {
                  setWrongBank(prev => [...prev, q.id]);
              }
          };

          const finishMockExam = () => {
              if (confirm("ç¢ºå®šäº¤å·ï¼Ÿ")) {
                  currentQuiz.forEach(q => {
                      const ans = quizAnswers[q.id];
                      const isCorrect = checkIsCorrect(q, ans);
                      if (ans) updateStats(q.subject, isCorrect);
                      if (!isCorrect && ans && !wrongBank.includes(q.id)) {
                          setWrongBank(prev => [...prev, q.id]);
                      } else if (isCorrect && wrongBank.includes(q.id)) {
                          setWrongBank(prev => prev.filter(id => id !== q.id));
                      }
                  });
                  setActiveTab('quiz_summary');
              }
          };

          const calculateScore = () => currentQuiz.reduce((acc, q) => checkIsCorrect(q, quizAnswers[q.id]) ? acc + 1 : acc, 0);
          
          const filteredBank = questions.filter(q => {
              const matchLvl = bankFilter.level === 'all' || q.level === bankFilter.level;
              const matchSub = bankFilter.subject === 'all' || q.subject === bankFilter.subject;
              const matchKey = !bankFilter.keyword || q.question.includes(bankFilter.keyword) || q.options.some(o=>o.includes(bankFilter.keyword));
              return matchLvl && matchSub && matchKey;
          });

          const ProgressBar = ({ c, t }) => <div className="w-full bg-slate-200 rounded-full h-2.5 mb-6 overflow-hidden"><div className={`bg-${ThemeColor}-600 h-2.5 rounded-full transition-all duration-500`} style={{ width: `${Math.round(((c + 1) / t) * 100)}%` }}></div></div>;

          // Font size classes
          const fontSizes = { 'text-sm': 'text-sm', 'text-base': 'text-base', 'text-lg': 'text-lg' };

          return (
            <div className={`min-h-screen pb-20 font-sans text-slate-800 selection:bg-${ThemeColor}-100 selection:text-${ThemeColor}-900 ${fontSizes[fontSize]}`}>
              {/* Header */}
              <div className="bg-white/90 backdrop-blur-md sticky top-0 z-20 border-b border-slate-200">
                <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                    <div className="flex items-center">
                        <div className={`bg-gradient-to-br from-${ThemeColor}-600 to-${ThemeColor}-700 p-2 rounded-xl mr-3 shadow-lg shadow-${ThemeColor}-200`}>
                            <FileJson className="text-white" size={24}/>
                        </div>
                        <div className="font-black text-xl tracking-tight text-slate-800 hidden md:block">{AppTitle}</div>
                    </div>
                    <div className="flex items-center gap-2">
                        <button onClick={()=>{const sizes=['text-sm','text-base','text-lg']; setFontSize(sizes[(sizes.indexOf(fontSize)+1)%3])}} className="p-2 rounded-lg hover:bg-slate-100 text-slate-500 font-bold flex items-center" title="èª¿æ•´å­—é«”å¤§å°">
                            <Type size={18} className="mr-1"/> <span className="text-xs">å­—é«”</span>
                        </button>
                    </div>
                </div>
                <div className="flex bg-slate-800 text-white p-1 overflow-x-auto shadow-md no-scrollbar justify-center">
                    <button onClick={() => handleNavChange('intro')} className={`flex items-center px-4 py-3 text-sm font-medium transition whitespace-nowrap ${activeTab === 'intro' ? `bg-${ThemeColor}-600 text-white` : 'hover:bg-slate-700 text-slate-300'}`}><Info size={18} className="mr-2"/> ç°¡ç« </button>
                    <button onClick={() => handleNavChange('bank')} className={`flex items-center px-4 py-3 text-sm font-medium transition whitespace-nowrap ${activeTab === 'bank' ? `bg-${ThemeColor}-600 text-white` : 'hover:bg-slate-700 text-slate-300'}`}><BookOpen size={18} className="mr-2"/> é¡Œåº«</button>
                    <button onClick={() => handleNavChange('import')} className={`flex items-center px-4 py-3 text-sm font-medium transition whitespace-nowrap ${activeTab === 'import' ? `bg-${ThemeColor}-600 text-white` : 'hover:bg-slate-700 text-slate-300'}`}><FolderOpen size={18} className="mr-2"/> ç®¡ç†</button>
                    <button onClick={() => handleNavChange('ai_import')} className={`flex items-center px-4 py-3 text-sm font-medium transition whitespace-nowrap ${activeTab === 'ai_import' ? `bg-${ThemeColor}-600 text-white` : 'hover:bg-slate-700 text-slate-300'}`}><Bot size={18} className="mr-2"/> AI åŒ¯å…¥</button>
                    <button onClick={() => handleNavChange('analysis')} className={`flex items-center px-4 py-3 text-sm font-medium transition whitespace-nowrap ${activeTab === 'analysis' ? `bg-${ThemeColor}-600 text-white` : 'hover:bg-slate-700 text-slate-300'}`}><BarChart2 size={18} className="mr-2"/> åˆ†æ</button>
                    <button onClick={() => handleNavChange('quiz')} className={`flex items-center px-6 py-3 text-sm font-bold transition whitespace-nowrap ${activeTab.includes('quiz') ? `bg-${ThemeColor}-500 text-white` : 'bg-slate-700 text-white hover:bg-slate-600'}`}><Play size={18} className="mr-2"/> æ¸¬é©— {isQuizActive && <span className="ml-2 w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>}</button>
                </div>
                {notification && <div className={`fixed top-24 right-4 px-6 py-3 rounded-xl shadow-2xl animate-bounce z-50 font-bold flex items-center ${notification.type === 'error' ? 'bg-red-500 text-white' : 'bg-slate-800 text-white'}`}>{notification.type === 'error' && <AlertTriangle size={18} className="mr-2"/>}{notification.msg}</div>}
              </div>

              <div className="max-w-5xl mx-auto mt-6 px-3 sm:px-4">
                {/* Intro Tab */}
                {activeTab === 'intro' && (
                    <div className="animate-fade-in space-y-6 max-w-4xl mx-auto">
                        <div className="grid md:grid-cols-2 gap-6 items-start">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-6 border-t-4 border-green-500 h-full flex flex-col">
                                <h3 className="font-bold text-lg mb-4 text-slate-800 flex items-center"><Book size={20} className="mr-2 text-green-600"/>åˆç´š é‘‘å®šè€ƒç§‘</h3>
                                <div className="space-y-4 flex-grow">
                                    {Object.entries(EXAM_DATA["åˆç´š"].subjects).map(([title, chapters], i) => <SyllabusAccordion key={i} title={title} chapters={chapters} color="green" />)}
                                </div>
                                <div className="mt-6 p-4 bg-slate-50 rounded text-xs text-slate-500 border border-slate-100"><strong>åŠæ ¼æ¨™æº–ï¼š</strong> {EXAM_DATA["åˆç´š"].passing}</div>
                            </div>
                            <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-6 border-t-4 border-blue-500 h-full flex flex-col">
                                <h3 className="font-bold text-lg mb-4 text-slate-800 flex items-center"><Book size={20} className="mr-2 text-blue-600"/>ä¸­ç´š é‘‘å®šè€ƒç§‘</h3>
                                <div className="space-y-4 flex-grow">
                                    {Object.entries(EXAM_DATA["ä¸­ç´š"].subjects).map(([title, chapters], i) => <SyllabusAccordion key={i} title={title} chapters={chapters} color="blue" />)}
                                </div>
                                <div className="mt-6 p-4 bg-slate-50 rounded text-xs text-slate-500 border border-slate-100"><strong>åŠæ ¼æ¨™æº–ï¼š</strong> {EXAM_DATA["ä¸­ç´š"].passing}</div>
                            </div>
                        </div>
                    </div>
                )}

                {/* Bank Tab with Search & Filter */}
                {activeTab === 'bank' && (
                   <div className="max-w-4xl mx-auto p-4 animate-fade-in">
                     <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 mb-6 sticky top-20 z-10">
                        <div className="flex flex-col md:flex-row gap-4 justify-between items-center">
                            <h2 className="text-xl font-bold text-slate-800 flex items-center whitespace-nowrap"> <BookOpen size={24} className={`mr-2 text-${ThemeColor}-600`}/> é¡Œåº« ({filteredBank.length}) </h2>
                            <div className="flex gap-2 w-full md:w-auto">
                                <select className="p-2 border rounded bg-slate-50 text-sm" value={bankFilter.level} onChange={e=>setBankFilter({...bankFilter, level:e.target.value})}>
                                    <option value="all">å…¨ç­‰ç´š</option><option value="åˆç´š">åˆç´š</option><option value="ä¸­ç´š">ä¸­ç´š</option>
                                </select>
                                <div className="relative flex-1 md:w-64">
                                    <Search size={16} className="absolute left-3 top-3 text-slate-400"/>
                                    <input type="text" placeholder="æœå°‹é¡Œç›®..." className="w-full pl-9 p-2 border border-slate-200 rounded text-sm outline-none" value={bankFilter.keyword} onChange={e=>setBankFilter({...bankFilter, keyword: e.target.value})}/>
                                </div>
                            </div>
                        </div>
                     </div>
                     <div className="space-y-4">
                        {filteredBank.length === 0 ? <div className="text-center py-20 text-slate-400 bg-white rounded-xl border-dashed border-2">ç„¡ç¬¦åˆæ¢ä»¶é¡Œç›®</div> : filteredBank.map((q) => (
                            <div key={q.id} className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 relative group hover:shadow-md transition">
                                <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                    <button onClick={()=>openEditModal(q)} className="text-slate-400 hover:text-blue-500"><Edit size={18}/></button>
                                    <button onClick={()=>deleteQuestion(q.id)} className="text-slate-400 hover:text-red-500"><Trash2 size={18}/></button>
                                </div>
                                <div className="flex flex-wrap gap-2 mb-3 text-xs">
                                    <span className={`${q.level==='åˆç´š'?'bg-green-100 text-green-800':'bg-blue-100 text-blue-800'} px-2 py-1 rounded font-bold`}>{q.level || 'ä¸­ç´š'}</span>
                                    <span className="bg-slate-100 text-slate-600 px-2 py-1 rounded">{q.subject}</span>
                                    {wrongBank.includes(q.id)&&<span className="bg-red-100 text-red-600 px-2 py-1 rounded font-bold">æ˜“éŒ¯é¡Œ</span>}
                                </div>
                                <h3 className="font-bold text-slate-800 mb-3">{q.question}</h3>
                                <div className="grid gap-2 text-sm text-slate-600 pl-4 border-l-2 border-slate-100">
                                    {q.options.map((opt, i) => <div key={i} className={normalizeAnswer(q).includes(opt)?'text-green-600 font-bold':''}>{String.fromCharCode(65+i)}. {opt}</div>)}
                                </div>
                                {q.explanation && <div className="text-xs text-slate-500 bg-slate-50 p-3 rounded mt-2">è§£æï¼š{q.explanation}</div>}
                            </div>
                        ))}
                     </div>
                   </div>
                )}

                {/* Import Tab */}
                {activeTab === 'import' && (
                   <div className="max-w-4xl mx-auto p-4 space-y-6 animate-fade-in">
                      <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                          <h3 className="font-bold text-xl mb-4 text-slate-800 flex items-center"><FileSpreadsheet className="mr-2 text-green-600"/> åŒ¯å…¥é¡Œåº« (Excel)</h3>
                          <div className="bg-blue-50 p-4 rounded-lg text-sm text-blue-800 border border-blue-100 mb-4">
                              <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-3">
                                <p className="font-bold flex items-center"><AlertTriangle size={16} className="mr-1"/> Excel æ¬„ä½é †åºï¼š</p>
                                <button onClick={downloadTemplate} className="bg-white border border-blue-200 text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-lg text-sm font-bold transition shadow-sm flex items-center whitespace-nowrap"><Download size={16} className="mr-2"/> ä¸‹è¼‰ç¯„ä¾‹æª”</button>
                              </div>
                              <div className="w-full overflow-x-auto pb-2">
                                <div className="flex gap-2 min-w-max">
                                    {['A:ç­‰ç´š', 'B:ç§‘ç›®', 'C:ä¸»é¡Œ', 'D:å…§å®¹', 'E:é¡Œç›®', 'F:é¸é …A', 'G:é¸é …B', 'H:é¸é …C', 'I:é¸é …D', 'J:ç­”æ¡ˆ', 'K:è§£æ'].map((h,i)=>(
                                        <div key={i} className="bg-white px-3 py-2 rounded border border-blue-200 font-mono text-xs shadow-sm whitespace-nowrap">{h}</div>
                                    ))}
                                </div>
                              </div>
                          </div>
                          <input type="file" accept=".xlsx,.xls" onChange={handleExcelUpload} className={`block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-bold file:bg-${ThemeColor}-50 file:text-${ThemeColor}-700 hover:file:bg-${ThemeColor}-100`}/>
                          {bulkPreview.length > 0 && <button onClick={()=>{setQuestions([...questions,...bulkPreview]);setBulkPreview([]);showNotify(`å·²åŒ¯å…¥ ${bulkPreview.length} é¡Œ`)}} className="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg font-bold flex items-center"><CheckCircle size={18} className="mr-2"/> ç¢ºèªåŒ¯å…¥</button>}
                      </section>
                      <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                          <h3 className={`font-bold text-xl mb-4 text-slate-800 flex items-center`}> <Save className={`mr-2 text-${ThemeColor}-600`}/> åŒ¯å‡ºé¡Œåº« </h3>
                          <button onClick={exportToExcel} className="p-4 border border-slate-200 rounded-lg hover:bg-slate-50 text-left w-full group">
                              <div className="font-bold text-slate-700 flex items-center mb-1"><Download size={20} className="mr-2"/> åŒ¯å‡º Excel (å®Œæ•´å‚™ä»½)</div>
                              <div className="text-xs text-slate-500">åŒ…å«æ‰€æœ‰åˆç´šèˆ‡ä¸­ç´šé¡Œç›®</div>
                          </button>
                      </section>
                      <section className="bg-red-50 p-6 rounded-xl border border-red-100 flex gap-4">
                          <button onClick={()=>{if(confirm('æ¸…ç©ºéŒ¯é¡Œï¼Ÿ')){setWrongBank([]);showNotify('å·²æ¸…ç©º');}}} className="text-sm bg-white border border-red-200 text-red-600 px-4 py-2 rounded">æ¸…ç©ºéŒ¯é¡Œ</button>
                          <button onClick={()=>{if(confirm('è­¦å‘Šï¼šæ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤æ‰€æœ‰é¡Œç›®èˆ‡ç´€éŒ„ï¼Œä¸”ç„¡æ³•å¾©åŸï¼ç¢ºå®šè¦é‡ç½®ç³»çµ±å—ï¼Ÿ')){setQuestions([]);setWrongBank([]);showNotify('å·²é‡ç½®');}}} className="text-sm bg-red-600 text-white px-4 py-2 rounded">é‡ç½®ç³»çµ±</button>
                      </section>
                   </div>
                )}

                {/* AI Import Tab */}
                {activeTab === 'ai_import' && (
                    <div className="max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-lg border border-slate-100 mt-6 animate-fade-in">
                        <h2 className="text-xl font-bold mb-4 text-slate-800 flex items-center"><Bot className="mr-2 text-purple-600"/> AI å¿«é€ŸåŒ¯å…¥</h2>
                        <div className="bg-purple-50 p-4 rounded-lg text-sm text-purple-800 border border-purple-100 mb-4">
                            <p className="font-bold mb-2">ğŸ’¡ ä½¿ç”¨æ­¥é©Ÿï¼š</p>
                            <p>1. é¸æ“‡ç­‰ç´šä¸¦è¤‡è£½æŒ‡ä»¤ï¼Œè²¼çµ¦ AI (Gemini/ChatGPT)ã€‚</p>
                            <p>2. è¤‡è£½ AI å›å‚³çš„ JSON é™£åˆ— (å« [])ã€‚</p>
                            <p>3. è²¼ä¸Šè‡³ä¸‹æ–¹æ¬„ä½ä¸¦é»æ“ŠåŒ¯å…¥ã€‚</p>
                            <div className="flex gap-2 mt-4">
                                <button onClick={() => copyAiPrompt("åˆç´š")} className="flex-1 flex items-center justify-center bg-white border border-green-300 text-green-700 hover:bg-green-100 px-4 py-3 rounded-lg font-bold transition shadow-sm">
                                    <Copy size={16} className="mr-2"/> è¤‡è£½ã€Œåˆç´šã€æŒ‡ä»¤
                                </button>
                                <button onClick={() => copyAiPrompt("ä¸­ç´š")} className="flex-1 flex items-center justify-center bg-white border border-blue-300 text-blue-700 hover:bg-blue-100 px-4 py-3 rounded-lg font-bold transition shadow-sm">
                                    <Copy size={16} className="mr-2"/> è¤‡è£½ã€Œä¸­ç´šã€æŒ‡ä»¤
                                </button>
                            </div>
                            <p className="mt-3 text-xs text-slate-500 opacity-80 text-center">* æŒ‡ä»¤å·²åŒ…å«å®Œæ•´è€ƒç§‘ç´°é …èˆ‡å‡ºé¡Œé¢¨æ ¼è¦æ±‚</p>
                        </div>
                        <div className="mb-2 text-xs text-slate-500 font-bold flex justify-between items-center">
                            <span>è²¼ä¸Š JSON å…§å®¹ï¼š</span>
                            <span className="text-red-400 font-normal">â€» æ¨¡æ“¬è©¦é¡Œåƒ…ä¾›åƒè€ƒï¼Œéæ­£å¼è€ƒé¡Œå…§å®¹</span>
                        </div>
                        <textarea 
                            className="w-full p-4 border border-slate-200 rounded-xl h-64 font-mono text-xs outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition" 
                            placeholder='[{"level": "ä¸­ç´š", "subject": "...", "question": "...", "options": ["A", "B", "C", "D"], "correctAnswer": "A", "explanation": "..."}]'
                            value={jsonInput}
                            onChange={(e) => setJsonInput(e.target.value)}
                        />
                        <button onClick={handleJsonImport} className="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow-lg transition flex justify-center items-center">
                            <CheckCircle className="mr-2"/> ç¢ºèªåŒ¯å…¥
                        </button>
                    </div>
                )}

                {/* Analysis Tab */}
                {activeTab === 'analysis' && (
                    <div className="max-w-4xl mx-auto p-4 animate-fade-in space-y-6">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h2 className="text-xl font-bold mb-6 flex items-center"><BarChart2 className="mr-2 text-purple-600"/> å­¸ç¿’æˆæ•ˆåˆ†æ</h2>
                            <div className="space-y-6">
                                {Object.keys(stats).length === 0 ? <div className="text-center text-slate-400 py-10">å°šç„¡ä½œç­”ç´€éŒ„ï¼Œè«‹å…ˆé€²è¡Œæ¸¬é©—</div> : 
                                 Object.entries(stats).map(([subject, data]) => {
                                    const percentage = data.total ? Math.round((data.correct / data.total) * 100) : 0;
                                    let color = 'bg-red-500';
                                    if(percentage >= 80) color = 'bg-green-500';
                                    else if(percentage >= 60) color = 'bg-yellow-500';
                                    
                                    return (
                                        <div key={subject}>
                                            <div className="flex justify-between mb-1">
                                                <span className="text-sm font-bold text-slate-700">{subject}</span>
                                                <span className="text-xs font-bold text-slate-500">{data.correct}/{data.total} ({percentage}%)</span>
                                            </div>
                                            <div className="w-full bg-slate-200 rounded-full h-2.5">
                                                <div className={`${color} h-2.5 rounded-full transition-all duration-1000`} style={{width: `${percentage}%`}}></div>
                                            </div>
                                        </div>
                                    );
                                 })
                                }
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h3 className="font-bold text-lg mb-4">éŒ¯é¡Œåº«æ¦‚æ³</h3>
                            <div className="text-3xl font-black text-slate-800 mb-2">{wrongBank.length} <span className="text-sm text-slate-400 font-normal">é¡Œå¾…è¤‡ç¿’</span></div>
                            <div className="flex gap-2 flex-wrap">
                                {Array.from(new Set(questions.filter(q=>wrongBank.includes(q.id)).map(q=>q.subject))).map(s=>(
                                    <span key={s} className="text-xs bg-red-50 text-red-600 px-2 py-1 rounded border border-red-100">{s}</span>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {/* Quiz Prep Tab */}
                {activeTab === 'quiz' && (
                   <div className="max-w-md mx-auto mt-10 p-8 bg-white rounded-2xl shadow-xl border border-slate-100 text-center animate-fade-in">
                      <h2 className="text-2xl font-bold mb-6 text-slate-800">æ¸¬é©—è¨­å®š</h2>
                      
                      {/* 1. Level */}
                      <div className="mb-4">
                        <label className="block text-xs font-bold text-slate-400 mb-2 text-left">ç­‰ç´š</label>
                        <div className="flex gap-2">
                            {["åˆç´š", "ä¸­ç´š"].map(lvl => (
                                <button key={lvl} onClick={()=>setQuizConfig({...quizConfig, level: lvl, subject: 'all'})} className={`flex-1 py-2 rounded-lg border-2 font-bold transition text-sm ${quizConfig.level === lvl ? (lvl==='åˆç´š'?'border-green-500 bg-green-50 text-green-700':'border-blue-500 bg-blue-50 text-blue-700') : 'border-slate-100 text-slate-400'}`}>{lvl}</button>
                            ))}
                        </div>
                      </div>

                      {/* 2. Subject */}
                      <div className="mb-4 text-left">
                          <label className="block text-xs font-bold text-slate-400 mb-1">ç§‘ç›®</label>
                          <select className="w-full p-2 border border-slate-200 rounded-lg outline-none bg-white text-sm" value={quizConfig.subject} onChange={e=>setQuizConfig({...quizConfig, subject: e.target.value})}>
                              <option value="all">æ‰€æœ‰ç§‘ç›®</option>
                              {getSubjects(quizConfig.level).map(s=><option key={s} value={s}>{s}</option>)}
                          </select>
                      </div>

                      {/* 3. Mode & Count */}
                      <div className="grid grid-cols-2 gap-4 mb-6 text-left">
                          <div>
                              <label className="block text-xs font-bold text-slate-400 mb-1">æ¨¡å¼</label>
                              <select className="w-full p-2 border border-slate-200 rounded-lg outline-none bg-white text-sm" value={quizConfig.mode} onChange={e=>setQuizConfig({...quizConfig, mode: e.target.value})}>
                                  <option value="normal">ç·´ç¿’ (å³æ™‚è©³è§£)</option>
                                  <option value="mock">æ¨¡æ“¬è€ƒ (è¨ˆæ™‚/äº¤å·)</option>
                                  <option value="wrong_review">éŒ¯é¡Œè¤‡ç¿’</option>
                              </select>
                          </div>
                          <div>
                              <label className="block text-xs font-bold text-slate-400 mb-1">é¡Œæ•¸</label>
                              <select className="w-full p-2 border border-slate-200 rounded-lg outline-none bg-white text-sm" value={quizConfig.count} onChange={e=>setQuizConfig({...quizConfig, count: e.target.value})}>
                                  <option value="10">10 é¡Œ</option>
                                  <option value="20">20 é¡Œ</option>
                                  <option value="50">50 é¡Œ</option>
                                  <option value="all">å…¨éƒ¨</option>
                              </select>
                          </div>
                      </div>
                      
                      <button onClick={startQuiz} className={`w-full bg-${ThemeColor}-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition transform hover:scale-[1.02]`}>é–‹å§‹æ¸¬é©—</button>
                   </div>
                )}
                
                {/* Quiz Running */}
                {activeTab === 'quiz_running' && currentQuiz[quizIndex] && (() => {
                   const q = currentQuiz[quizIndex];
                   const userAnswer = quizAnswers[q.id];
                   const isConfirmed = quizConfirmed.has(q.id);
                   const isMock = quizConfig.mode === 'mock';
                   
                   // Determine Question Type
                   const isMulti = q.question.includes("è¤‡é¸") || q.correctAnswer.includes("é¸é …") || q.correctAnswer.includes(",");
                   
                   // Format timer
                   const mins = Math.floor(timer / 60);
                   const secs = timer % 60;
                   const timeStr = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;

                   return (
                     <div className="relative">
                       {/* Timer for Mock */}
                       {isMock && (
                           <div className="fixed top-20 right-4 z-30 bg-slate-800 text-white px-4 py-2 rounded-full font-mono font-bold shadow-lg flex items-center">
                               <Clock size={16} className="mr-2"/> {timeStr}
                           </div>
                       )}

                       {/* Nav Buttons */}
                       <div className="fixed top-1/2 -translate-y-1/2 z-50 flex flex-col gap-4 right-4 lg:right-auto lg:left-1/2 lg:ml-[26rem]">
                          <button onClick={() => setQuizIndex(i => Math.max(0, i - 1))} disabled={quizIndex === 0} className={`p-3 rounded-full shadow-lg transition-transform hover:scale-110 flex flex-col items-center justify-center gap-1 ${quizIndex === 0 ? 'bg-slate-200 text-slate-400 cursor-not-allowed' : 'bg-white text-slate-700 hover:text-blue-600 border border-slate-200'}`}><ChevronUp size={20} /><span className="text-[10px] font-bold">ä¸Šä¸€é¡Œ</span></button>
                          <button onClick={() => { if (quizIndex < currentQuiz.length - 1) setQuizIndex(i => i + 1); else if (isMock) finishMockExam(); else if (isConfirmed) setActiveTab('quiz_summary'); }} disabled={!isMock && !isConfirmed && quizIndex === currentQuiz.length - 1} className={`p-3 rounded-full shadow-lg transition-transform hover:scale-110 flex flex-col items-center justify-center gap-1 ${(!isMock && !isConfirmed && quizIndex === currentQuiz.length - 1) ? 'bg-slate-200 text-slate-400' : `bg-${ThemeColor}-600 text-white hover:bg-${ThemeColor}-700`}`}><ChevronDown size={20} /><span className="text-[10px] font-bold">ä¸‹ä¸€é¡Œ</span></button>
                       </div>

                       <div className="max-w-3xl mx-auto mt-4 p-6 bg-white rounded-2xl shadow-xl border border-slate-100 animate-fade-in min-h-[60vh] flex flex-col relative">
                          <div className="flex justify-between mb-6">
                              <span className="text-xs font-bold text-slate-400 uppercase">Q {quizIndex + 1} / {currentQuiz.length} <span className={`ml-2 px-2 py-0.5 rounded text-xs ${q.level==='åˆç´š'?'bg-green-100 text-green-700':'bg-blue-100 text-blue-700'}`}>{q.level}</span> {isMulti && <span className="ml-1 px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs">è¤‡é¸</span>}</span>
                              <button onClick={()=>{if(confirm('ç¢ºå®šè¦çµæŸæ¸¬é©—ï¼Ÿ')) setActiveTab('quiz')}} className="text-slate-400 hover:text-red-500 text-sm font-bold">é€€å‡º</button>
                          </div>
                          {!isMock && <ProgressBar c={quizIndex} t={currentQuiz.length} />}
                          <h2 className="text-xl md:text-2xl font-bold text-slate-800 mb-8 flex-grow">{q.question}</h2>
                          
                          <div className="space-y-3 mb-8">
                             {q.options.map((opt, i) => {
                                 let style = `w-full text-left p-4 rounded-xl border-2 transition-all flex items-center relative `;
                                 const isSelected = isMulti 
                                     ? Array.isArray(userAnswer) && userAnswer.includes(opt)
                                     : userAnswer === opt;

                                 if (isMock || !isConfirmed) {
                                     // Not yet confirmed or Mock: Selection Style
                                     style += isSelected ? `border-${ThemeColor}-600 bg-${ThemeColor}-50` : `border-slate-200 hover:border-${ThemeColor}-300 hover:bg-${ThemeColor}-50`;
                                 } else {
                                     // Confirmed: Result Style
                                     // Note: checkIsCorrect logic might be complex for visual indication of partials, here we simplify.
                                     // We show: Correct Answer (Green), User Wrong Selection (Red)
                                     const correctSet = normalizeAnswer(q);
                                     const isOptCorrect = correctSet.includes(opt);
                                     
                                     if (isOptCorrect) style += "border-green-500 bg-green-50"; // Correct Option
                                     else if (isSelected) style += "border-red-500 bg-red-50"; // Wrong Selection
                                     else style += "border-slate-100 opacity-50"; // Irrelevant
                                 }
                                 
                                 return (
                                     <button key={i} onClick={() => handleOptionClick(q, opt)} disabled={isConfirmed && !isMock} className={style}>
                                         <div className={`w-8 h-8 rounded-full border-2 mr-4 flex items-center justify-center font-bold ${isMulti ? 'rounded-md' : 'rounded-full'}`}>
                                             {isMulti && isSelected ? <CheckSquare size={16}/> : String.fromCharCode(65+i)}
                                         </div>
                                         {opt}
                                     </button>
                                 );
                             })}
                          </div>
                          
                          {/* Footer Area */}
                          {!isMock && !isConfirmed && isMulti && (
                              <button onClick={() => submitAnswer(q, null)} className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-lg hover:bg-slate-900 transition">ç¢ºèªé€å‡º</button>
                          )}

                          {(!isMock && isConfirmed) && (
                              <div className="animate-slide-up bg-slate-50 -mx-6 -mb-6 p-6 rounded-b-2xl border-t border-slate-200">
                                  <div className={`font-bold text-lg mb-2 ${checkIsCorrect(q, userAnswer)?'text-green-600':'text-red-500'}`}>{checkIsCorrect(q, userAnswer)?'ç­”å°':'ç­”éŒ¯'}</div>
                                  <div className="text-slate-600 mb-4 text-sm">è§£æï¼š{q.explanation||"ç„¡"}</div>
                                  <button onClick={() => quizIndex < currentQuiz.length - 1 ? setQuizIndex(i=>i+1) : setActiveTab('quiz_summary')} className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-lg">ä¸‹ä¸€é¡Œ</button>
                              </div>
                          )}
                          {isMock && (
                              <div className="mt-auto pt-4 border-t border-slate-100 flex justify-between items-center">
                                  <span className="text-xs text-slate-400">æ¨¡æ“¬è€ƒæ¨¡å¼ï¼šäº¤å·å¾Œé¡¯ç¤ºæˆç¸¾</span>
                                  {quizIndex === currentQuiz.length - 1 && <button onClick={finishMockExam} className="bg-red-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-red-700">äº¤å·</button>}
                              </div>
                          )}
                       </div>
                     </div>
                   );
                })()}

                {/* Quiz Summary */}
                {activeTab === 'quiz_summary' && (
                  <div className="max-w-2xl mx-auto mt-10 animate-fade-in">
                      <div className="bg-white p-10 rounded-2xl shadow-xl text-center border border-slate-100 mb-6">
                          <div className="text-6xl mb-6 animate-bounce-slow">ğŸ‰</div>
                          <div className={`text-5xl font-black text-${ThemeColor}-600 mb-2`}>{Math.round((calculateScore()/currentQuiz.length)*100)}åˆ†</div>
                          <div className="text-slate-500 mb-8">ç­”å° {calculateScore()} / {currentQuiz.length} é¡Œ</div>
                          <div className="flex gap-3 justify-center">
                              <button onClick={()=>setActiveTab('quiz')} className="bg-slate-100 px-8 py-3 rounded-xl font-bold hover:bg-slate-200">å›é¸å–®</button>
                              <button onClick={startQuiz} className={`bg-${ThemeColor}-600 text-white px-8 py-3 rounded-xl font-bold hover:shadow-lg`}>å†æ¸¬ä¸€æ¬¡</button>
                          </div>
                      </div>
                      
                      {/* Review Section */}
                      <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                          <div className="p-4 bg-slate-50 border-b border-slate-200 font-bold text-slate-700">ç­”é¡Œæª¢è¨</div>
                          <div className="divide-y divide-slate-100">
                              {currentQuiz.map((q, i) => {
                                  const userAns = quizAnswers[q.id];
                                  const isCorrect = checkIsCorrect(q, userAns);
                                  const formatAns = (ans) => Array.isArray(ans) ? ans.join(", ") : ans;
                                  
                                  return (
                                      <div key={q.id} className="p-4">
                                          <div className="flex gap-3">
                                              <div className={`mt-1 w-6 h-6 flex-shrink-0 rounded-full flex items-center justify-center text-xs font-bold text-white ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`}>{i+1}</div>
                                              <div>
                                                  <div className="font-bold text-slate-800 mb-2">{q.question}</div>
                                                  <div className="text-sm space-y-1 mb-2">
                                                      <div className={isCorrect ? 'text-green-600' : 'text-red-500'}>æ‚¨çš„ç­”æ¡ˆï¼š{formatAns(userAns) || 'æœªä½œç­”'}</div>
                                                      {!isCorrect && <div className="text-green-600">æ­£ç¢ºç­”æ¡ˆï¼š{formatAns(normalizeAnswer(q))}</div>}
                                                  </div>
                                                  <div className="text-xs bg-slate-50 p-2 rounded text-slate-500">è§£æï¼š{q.explanation}</div>
                                              </div>
                                          </div>
                                      </div>
                                  );
                              })}
                          </div>
                      </div>
                  </div>
                )}
                
                {/* Edit Modal (Hidden Logic Only) */}
                {showEditModal && (
                    <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 shadow-2xl animate-fade-in">
                            <h3 className="font-bold text-xl mb-4 text-slate-800">ç·¨è¼¯è©¦é¡Œ</h3>
                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <select className="p-2 border rounded" value={newQ.level} onChange={e=>setNewQ({...newQ, level:e.target.value})}>
                                        <option value="åˆç´š">åˆç´š</option><option value="ä¸­ç´š">ä¸­ç´š</option>
                                    </select>
                                    <input className="p-2 border rounded" placeholder="ç§‘ç›®" value={newQ.subject} onChange={e=>setNewQ({...newQ, subject:e.target.value})} />
                                </div>
                                <textarea className="w-full p-2 border rounded h-24" placeholder="é¡Œç›®" value={newQ.question} onChange={e=>setNewQ({...newQ, question:e.target.value})} />
                                <div className="grid grid-cols-1 gap-2">
                                    {newQ.options.map((o,i) => (
                                        <div key={i} className="flex gap-2 items-center">
                                            <div className="w-6 text-center text-slate-400">{String.fromCharCode(65+i)}</div>
                                            <input className="flex-1 p-2 border rounded" value={o} onChange={e=>{const ops=[...newQ.options];ops[i]=e.target.value;setNewQ({...newQ, options:ops})}} />
                                        </div>
                                    ))}
                                    <input className="p-2 border rounded w-full" placeholder="æ­£ç¢ºç­”æ¡ˆ (å–®é¸å¡«Aï¼Œè¤‡é¸å¡« A,B æˆ– é¸é …1,é¸é …2)" value={newQ.correctAnswer} onChange={e=>setNewQ({...newQ, correctAnswer:e.target.value})} />
                                </div>
                                <textarea className="w-full p-2 border rounded h-20" placeholder="è§£æ" value={newQ.explanation} onChange={e=>setNewQ({...newQ, explanation:e.target.value})} />
                                <div className="flex gap-3 justify-end pt-4">
                                    <button onClick={()=>setShowEditModal(false)} className="px-4 py-2 text-slate-500 font-bold hover:bg-slate-100 rounded-lg">å–æ¶ˆ</button>
                                    <button onClick={saveQuestion} className={`px-6 py-2 bg-${ThemeColor}-600 text-white font-bold rounded-lg hover:bg-${ThemeColor}-700`}>å„²å­˜è®Šæ›´</button>
                                </div>
                            </div>
                        </div>
                    </div>
                )}

                {/* System Helper */}
                <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end">
                    {helperOpen && (
                        <div className="mb-4 w-72 bg-white rounded-xl shadow-2xl border border-slate-100 overflow-hidden animate-slide-up">
                            <div className={`bg-gradient-to-r from-${ThemeColor}-600 to-${ThemeColor}-700 text-white p-3 font-bold flex justify-between`}><span>ç³»çµ±å°å¹«æ‰‹</span><button onClick={()=>setHelperOpen(false)}><X size={16}/></button></div>
                            <div className="p-4 text-sm text-slate-600 space-y-3 h-80 overflow-y-auto">
                                <div className="space-y-1">
                                    <p className="font-bold text-slate-800 flex items-center"><FolderOpen size={16} className="mr-1"/> 1. åŒ¯å…¥/åŒ¯å‡º</p>
                                    <p className="text-xs ml-5">ç®¡ç†é é¢å¯ä¸‹è¼‰ Excel ç¯„ä¾‹ï¼Œæ‰¹é‡åŒ¯å…¥é¡Œç›®ã€‚</p>
                                </div>
                                <div className="space-y-1">
                                    <p className="font-bold text-slate-800 flex items-center"><Bot size={16} className="mr-1"/> 2. AI å¿«é€ŸåŒ¯å…¥</p>
                                    <p className="text-xs ml-5">æä¾›ä¸­ç´š/åˆç´šå°ˆå±¬æŒ‡ä»¤ï¼Œæ”¯æ´ã€Œè¤‡é¸é¡Œã€èˆ‡ã€Œæƒ…å¢ƒé¡Œã€ç”Ÿæˆã€‚</p>
                                </div>
                                <div className="space-y-1">
                                    <p className="font-bold text-slate-800 flex items-center"><Play size={16} className="mr-1"/> 3. é–‹å§‹æ¸¬é©—</p>
                                    <p className="text-xs ml-5">æ–°å¢ã€Œè¤‡é¸é¡Œã€æ”¯æ´ï¼Œéœ€æ‰‹å‹•é»æ“Šã€Œé€å‡ºã€æ‰æœƒè¨ˆåˆ†ã€‚</p>
                                </div>
                                 <div className="space-y-1">
                                    <p className="font-bold text-slate-800 flex items-center"><BarChart2 size={16} className="mr-1"/> 4. æˆæ•ˆåˆ†æ</p>
                                    <p className="text-xs ml-5">åœ¨ã€Œåˆ†æã€é é¢æŸ¥çœ‹å„ç§‘ç›®çš„ç­”é¡Œæ­£ç¢ºç‡èˆ‡éŒ¯é¡Œåˆ†ä½ˆã€‚</p>
                                </div>
                                <div className="bg-blue-50 p-2 rounded border border-blue-100 mt-2">
                                    <strong className="text-blue-800 text-xs">ğŸ’¡ å°æç¤º</strong>
                                    <p className="text-xs text-blue-600">å³ä¸Šè§’å¯èª¿æ•´å­—é«”å¤§å°ã€‚</p>
                                </div>
                            </div>
                        </div>
                    )}
                    <button onClick={()=>setHelperOpen(!helperOpen)} className={`${helperOpen?'bg-slate-500':`bg-${ThemeColor}-600`} text-white p-4 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center justify-center`}>{helperOpen?<X size={24}/>:<MessageCircleQuestion size={28}/>}</button>
                </div>

              </div>
            </div>
          );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExamSystem />);
    </script>
</body>
</html>
